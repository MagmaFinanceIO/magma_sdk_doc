# Add liquidity

## 1. Open position

### Method

Method: `sdk.Almm.mintByStrategy({
pair: string
bin_step: number
coinTypeA: string
coinTypeB: string
amountATotal: number // u64
amountBTotal: number // u64
fixCoinA: boolean
fixCoinB: boolean
strategy: number // u8
min_bin: number // RealID
max_bin: number // RealID
active_bin: number // RealID
slippage: number // 10000 = 100%
}: MintByStrategyParams
)`

### Params

- `pair`: The pool object ID.

- `bin_step`: Property of a pool. Like `tick_spacing` in uniswap v3 like pools.

- `coinTypeA`: the coin type address about coinA.

- `coinTypeB`: the coin type address about coinB.

- `amountATotal`: How much coin A you want to deposit into position

- `amountBTotal`: How much coin B you want to deposit into position

- `fixCoinA`: If true, will use amountATotal to calc amountBTotal based on `strategy`

- `fixCoinB`: If true, will use amountBTotal to calc amountATotal based on `strategy`

- `strategy`:

  ```typescript
  export enum StrategyType {
    Spot = 1,
    Curve = 2,
    BidAsk = 3,
  }
  ```

- `min_bin`: min bin index of your position. Something like tick_lower in uniswap v3

- `max_bin`: max bin index of your position. Something like tick_upper in uniswap v3

- `active_bin`: current acrtive bin of pool. Used to calc slippage of pool price

- `slippage`: Pool price slippage when you create position. Max 10000, means 100%, 100 means 1% etc.

> About RealID
>
> When retrieve pool_info, you can get `active_bin` of pool. This `active_bin` is current bin_index of pool, bin index stored onchain is all non-negative numbers, and it's called `storage_id` of a bin.
> If you want to calc price of a bin index, you need to convert `storage_id` to `real_id` using function provided by `@magmaprotocol/calc_almm`

```typescript
import {
  get_price_x128_from_real_id,
  get_real_id_from_price_x128,
  get_storage_id_from_real_id,
  get_real_id, // get real_id from storage_id
} from "@magmaprotocol/calc_almm";
```

> Here is the frequently used pipeline:
>
> 1. get storage_id from almm pool_info, then convert storage_id to real_id
> 2. convert real_id to `price * 10.pow(128)`
> 3. calc your position range by price
> 4. convert price range to real_id by `get_real_id_from_price_x128` provided by `@magmaprotocol/calc_almm`
> 5. call function `mintByStrategy`

## 2. Add liquidity to exist positions

### Method

Method: `sdk.Almm.mintByStrategy({
pair: string
positionId: string
bin_step: number
coinTypeA: string
coinTypeB: string
amountATotal: number // u64
amountBTotal: number // u64
fixCoinA: boolean
fixCoinB: boolean
strategy: number // u8
min_bin: number // RealID. u32
max_bin: number // RealID. u32
active_bin: number // RealID. Used for calc slippage
slippage: number // base 10000
receiver: string
rewards_token: string[]
}: RaiseByStrategyParams
)`

### Params

Refer `create position`
